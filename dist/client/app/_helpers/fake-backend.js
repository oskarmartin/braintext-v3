"use strict";
Object.defineProperty(exports, "__esModule", { value: true });
var http_1 = require("@angular/http");
var testing_1 = require("@angular/http/testing");
function fakeBackendFactory(backend, options, realBackEnd) {
    var users = JSON.parse(localStorage.getItem('users')) || [];
    backend.connections.subscribe(function (connection) {
        setTimeout(function () {
            if (connection.request.url.endsWith('/api/authenticate') && connection.request.method == http_1.RequestMethod.Post) {
                var params_1 = JSON.parse(connection.request.getBody());
                var filteredUsers = users.filter(function (user) {
                    return user.username === params_1.username && user.password === params_1.password;
                });
                if (filteredUsers.length) {
                    var user = filteredUsers[0];
                    connection.mockRespond(new http_1.Response(new http_1.ResponseOptions({
                        status: 200,
                        body: {
                            id: user.id,
                            username: user.username,
                            firstName: user.firstName,
                            lastName: user.lastName,
                            token: "fake-jwt-token"
                        }
                    })));
                }
                else {
                    connection.mockError(new Error("Username or password incorrect!"));
                }
                return;
            }
            if (connection.request.url.endsWith('/api/users') && connection.request.method === http_1.RequestMethod.Get) {
                if (connection.request.headers.get('Authorization') === 'Bearer fake-jwt-token') {
                    connection.mockRespond(new http_1.Response(new http_1.ResponseOptions({
                        status: 200,
                        body: users
                    })));
                }
                else {
                    connection.mockRespond(new http_1.Response(new http_1.ResponseOptions({
                        status: 401
                    })));
                }
                return;
            }
            if (connection.request.url.endsWith('/api/users') && connection.request.method === http_1.RequestMethod.Post) {
                var newUser_1 = JSON.parse(connection.request.getBody());
                var duplicateUser = users.filter(function (user) {
                    return user.username === newUser_1.username;
                }).length;
                if (duplicateUser) {
                    return connection.mockError(new Error("Username: " + newUser_1.username + " is already taken!"));
                }
                newUser_1.id = users.length + 1;
                users.push(newUser_1);
                localStorage.setItem('users', JSON.stringify(users));
                connection.mockRespond(new http_1.Response(new http_1.ResponseOptions({
                    status: 200
                })));
                return true;
            }
            var realHttp = new http_1.Http(realBackEnd, options);
            var requestOptions = new http_1.RequestOptions({
                method: connection.request.method,
                headers: connection.request.headers,
                body: connection.request.getBody(),
                url: connection.request.url,
                withCredentials: connection.request.withCredentials,
                responseType: connection.request.responseType
            });
            realHttp.request(connection.request.url, requestOptions)
                .subscribe(function (response) {
                connection.mockRespond(response);
            }, function (error) {
                connection.mockError(error);
            });
        }, 500);
    });
    return new http_1.Http(backend, options);
}
exports.fakeBackendFactory = fakeBackendFactory;
;
exports.fakeBackendProvider = {
    provide: http_1.Http,
    useFactory: fakeBackendFactory,
    deps: [testing_1.MockBackend, http_1.BaseRequestOptions, http_1.XHRBackend]
};

//# sourceMappingURL=data:application/json;charset=utf8;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbImFwcC9faGVscGVycy9mYWtlLWJhY2tlbmQudHMiXSwibmFtZXMiOltdLCJtYXBwaW5ncyI6Ijs7QUFBQSxzQ0FDMkQ7QUFDM0QsaURBQW9FO0FBRXBFLDRCQUFtQyxPQUFvQixFQUFFLE9BQTJCLEVBQUUsV0FBdUI7SUFDekcsSUFBSSxLQUFLLEdBQVUsSUFBSSxDQUFDLEtBQUssQ0FBQyxZQUFZLENBQUMsT0FBTyxDQUFDLE9BQU8sQ0FBQyxDQUFDLElBQUksRUFBRSxDQUFDO0lBRW5FLE9BQU8sQ0FBQyxXQUFXLENBQUMsU0FBUyxDQUFDLFVBQUMsVUFBMEI7UUFDckQsVUFBVSxDQUFDO1lBQ1AsRUFBRSxDQUFBLENBQUMsVUFBVSxDQUFDLE9BQU8sQ0FBQyxHQUFHLENBQUMsUUFBUSxDQUFDLG1CQUFtQixDQUFDLElBQUksVUFBVSxDQUFDLE9BQU8sQ0FBQyxNQUFNLElBQUksb0JBQWEsQ0FBQyxJQUFJLENBQUMsQ0FBQSxDQUFDO2dCQUN4RyxJQUFJLFFBQU0sR0FBRyxJQUFJLENBQUMsS0FBSyxDQUFDLFVBQVUsQ0FBQyxPQUFPLENBQUMsT0FBTyxFQUFFLENBQUMsQ0FBQztnQkFFdEQsSUFBSSxhQUFhLEdBQUcsS0FBSyxDQUFDLE1BQU0sQ0FBQyxVQUFBLElBQUk7b0JBQ2pDLE1BQU0sQ0FBQyxJQUFJLENBQUMsUUFBUSxLQUFLLFFBQU0sQ0FBQyxRQUFRLElBQUksSUFBSSxDQUFDLFFBQVEsS0FBSyxRQUFNLENBQUMsUUFBUSxDQUFDO2dCQUNsRixDQUFDLENBQUMsQ0FBQztnQkFFSCxFQUFFLENBQUEsQ0FBQyxhQUFhLENBQUMsTUFBTSxDQUFDLENBQUEsQ0FBQztvQkFDckIsSUFBSSxJQUFJLEdBQUcsYUFBYSxDQUFDLENBQUMsQ0FBQyxDQUFDO29CQUM1QixVQUFVLENBQUMsV0FBVyxDQUFDLElBQUksZUFBUSxDQUFDLElBQUksc0JBQWUsQ0FBQzt3QkFDcEQsTUFBTSxFQUFFLEdBQUc7d0JBQ1gsSUFBSSxFQUFFOzRCQUNGLEVBQUUsRUFBRSxJQUFJLENBQUMsRUFBRTs0QkFDWCxRQUFRLEVBQUUsSUFBSSxDQUFDLFFBQVE7NEJBQ3ZCLFNBQVMsRUFBRSxJQUFJLENBQUMsU0FBUzs0QkFDekIsUUFBUSxFQUFFLElBQUksQ0FBQyxRQUFROzRCQUN2QixLQUFLLEVBQUUsZ0JBQWdCO3lCQUMxQjtxQkFDSixDQUFDLENBQUMsQ0FBQyxDQUFDO2dCQUNULENBQUM7Z0JBQUEsSUFBSSxDQUFBLENBQUM7b0JBQ0YsVUFBVSxDQUFDLFNBQVMsQ0FBQyxJQUFJLEtBQUssQ0FBQyxpQ0FBaUMsQ0FBQyxDQUFDLENBQUM7Z0JBQ3ZFLENBQUM7Z0JBQ0QsTUFBTSxDQUFDO1lBQ1gsQ0FBQztZQUNELEVBQUUsQ0FBQSxDQUFDLFVBQVUsQ0FBQyxPQUFPLENBQUMsR0FBRyxDQUFDLFFBQVEsQ0FBQyxZQUFZLENBQUMsSUFBSSxVQUFVLENBQUMsT0FBTyxDQUFDLE1BQU0sS0FBSyxvQkFBYSxDQUFDLEdBQUcsQ0FBQyxDQUFBLENBQUM7Z0JBQ2pHLEVBQUUsQ0FBQSxDQUFDLFVBQVUsQ0FBQyxPQUFPLENBQUMsT0FBTyxDQUFDLEdBQUcsQ0FBQyxlQUFlLENBQUMsS0FBSyx1QkFBdUIsQ0FBQyxDQUFBLENBQUM7b0JBQzVFLFVBQVUsQ0FBQyxXQUFXLENBQUMsSUFBSSxlQUFRLENBQUMsSUFBSSxzQkFBZSxDQUFDO3dCQUNwRCxNQUFNLEVBQUUsR0FBRzt3QkFDWCxJQUFJLEVBQUUsS0FBSztxQkFDZCxDQUFDLENBQUMsQ0FBQyxDQUFDO2dCQUNULENBQUM7Z0JBQUMsSUFBSSxDQUFDLENBQUM7b0JBQ0osVUFBVSxDQUFDLFdBQVcsQ0FBQyxJQUFJLGVBQVEsQ0FBQyxJQUFJLHNCQUFlLENBQUM7d0JBQ3BELE1BQU0sRUFBRSxHQUFHO3FCQUNkLENBQUMsQ0FBQyxDQUFDLENBQUM7Z0JBQ1QsQ0FBQztnQkFDRCxNQUFNLENBQUM7WUFDWCxDQUFDO1lBQ0QsRUFBRSxDQUFBLENBQUMsVUFBVSxDQUFDLE9BQU8sQ0FBQyxHQUFHLENBQUMsUUFBUSxDQUFDLFlBQVksQ0FBQyxJQUFJLFVBQVUsQ0FBQyxPQUFPLENBQUMsTUFBTSxLQUFLLG9CQUFhLENBQUMsSUFBSSxDQUFDLENBQUEsQ0FBQztnQkFDbEcsSUFBSSxTQUFPLEdBQUcsSUFBSSxDQUFDLEtBQUssQ0FBQyxVQUFVLENBQUMsT0FBTyxDQUFDLE9BQU8sRUFBRSxDQUFDLENBQUM7Z0JBRXZELElBQUksYUFBYSxHQUFHLEtBQUssQ0FBQyxNQUFNLENBQUMsVUFBQSxJQUFJO29CQUNqQyxNQUFNLENBQUMsSUFBSSxDQUFDLFFBQVEsS0FBSyxTQUFPLENBQUMsUUFBUSxDQUFBO2dCQUM3QyxDQUFDLENBQUMsQ0FBQyxNQUFNLENBQUM7Z0JBQ1YsRUFBRSxDQUFBLENBQUMsYUFBYSxDQUFDLENBQUEsQ0FBQztvQkFDZCxNQUFNLENBQUMsVUFBVSxDQUFDLFNBQVMsQ0FBQyxJQUFJLEtBQUssQ0FBQyxZQUFZLEdBQUcsU0FBTyxDQUFDLFFBQVEsR0FBRyxvQkFBb0IsQ0FBQyxDQUFDLENBQUM7Z0JBQ25HLENBQUM7Z0JBQ0QsU0FBTyxDQUFDLEVBQUUsR0FBRyxLQUFLLENBQUMsTUFBTSxHQUFHLENBQUMsQ0FBQztnQkFDOUIsS0FBSyxDQUFDLElBQUksQ0FBQyxTQUFPLENBQUMsQ0FBQztnQkFDcEIsWUFBWSxDQUFDLE9BQU8sQ0FBQyxPQUFPLEVBQUUsSUFBSSxDQUFDLFNBQVMsQ0FBQyxLQUFLLENBQUMsQ0FBQyxDQUFDO2dCQUVyRCxVQUFVLENBQUMsV0FBVyxDQUFDLElBQUksZUFBUSxDQUFDLElBQUksc0JBQWUsQ0FBQztvQkFDcEQsTUFBTSxFQUFFLEdBQUc7aUJBQ2QsQ0FBQyxDQUFDLENBQUMsQ0FBQztnQkFDTCxNQUFNLENBQUMsSUFBSSxDQUFDO1lBQ2hCLENBQUM7WUFDRCxJQUFJLFFBQVEsR0FBRyxJQUFJLFdBQUksQ0FBQyxXQUFXLEVBQUUsT0FBTyxDQUFDLENBQUM7WUFDOUMsSUFBSSxjQUFjLEdBQUcsSUFBSSxxQkFBYyxDQUFDO2dCQUNwQyxNQUFNLEVBQUUsVUFBVSxDQUFDLE9BQU8sQ0FBQyxNQUFNO2dCQUNqQyxPQUFPLEVBQUUsVUFBVSxDQUFDLE9BQU8sQ0FBQyxPQUFPO2dCQUNuQyxJQUFJLEVBQUUsVUFBVSxDQUFDLE9BQU8sQ0FBQyxPQUFPLEVBQUU7Z0JBQ2xDLEdBQUcsRUFBRSxVQUFVLENBQUMsT0FBTyxDQUFDLEdBQUc7Z0JBQzNCLGVBQWUsRUFBRSxVQUFVLENBQUMsT0FBTyxDQUFDLGVBQWU7Z0JBQ25ELFlBQVksRUFBRSxVQUFVLENBQUMsT0FBTyxDQUFDLFlBQVk7YUFDaEQsQ0FBQyxDQUFDO1lBQ0gsUUFBUSxDQUFDLE9BQU8sQ0FBQyxVQUFVLENBQUMsT0FBTyxDQUFDLEdBQUcsRUFBRSxjQUFjLENBQUM7aUJBQ25ELFNBQVMsQ0FBQyxVQUFDLFFBQWtCO2dCQUMxQixVQUFVLENBQUMsV0FBVyxDQUFDLFFBQVEsQ0FBQyxDQUFDO1lBQ3JDLENBQUMsRUFDRCxVQUFDLEtBQVU7Z0JBQ1AsVUFBVSxDQUFDLFNBQVMsQ0FBQyxLQUFLLENBQUMsQ0FBQztZQUNoQyxDQUFDLENBQUMsQ0FBQTtRQUNWLENBQUMsRUFBRSxHQUFHLENBQUMsQ0FBQztJQUNaLENBQUMsQ0FBQyxDQUFDO0lBQ0gsTUFBTSxDQUFDLElBQUksV0FBSSxDQUFDLE9BQU8sRUFBRSxPQUFPLENBQUMsQ0FBQztBQUN0QyxDQUFDO0FBL0VELGdEQStFQztBQUFBLENBQUM7QUFDUyxRQUFBLG1CQUFtQixHQUFHO0lBQzdCLE9BQU8sRUFBRSxXQUFJO0lBQ2IsVUFBVSxFQUFFLGtCQUFrQjtJQUM5QixJQUFJLEVBQUUsQ0FBQyxxQkFBVyxFQUFFLHlCQUFrQixFQUFFLGlCQUFVLENBQUM7Q0FDdEQsQ0FBQyIsImZpbGUiOiJhcHAvX2hlbHBlcnMvZmFrZS1iYWNrZW5kLmpzIiwic291cmNlc0NvbnRlbnQiOlsiaW1wb3J0IHsgSHR0cCwgQmFzZVJlcXVlc3RPcHRpb25zLCBSZXNwb25zZSwgUmVzcG9uc2VPcHRpb25zLCBSZXF1ZXN0TWV0aG9kLFxuICAgICAgICAgWEhSQmFja2VuZCwgUmVxdWVzdE9wdGlvbnMgfSBmcm9tIFwiQGFuZ3VsYXIvaHR0cFwiO1xuaW1wb3J0IHsgTW9ja0JhY2tlbmQsIE1vY2tDb25uZWN0aW9uIH0gZnJvbSBcIkBhbmd1bGFyL2h0dHAvdGVzdGluZ1wiO1xuXG5leHBvcnQgZnVuY3Rpb24gZmFrZUJhY2tlbmRGYWN0b3J5KGJhY2tlbmQ6IE1vY2tCYWNrZW5kLCBvcHRpb25zOiBCYXNlUmVxdWVzdE9wdGlvbnMsIHJlYWxCYWNrRW5kOiBYSFJCYWNrZW5kKXtcbiAgICBsZXQgdXNlcnM6IGFueVtdID0gSlNPTi5wYXJzZShsb2NhbFN0b3JhZ2UuZ2V0SXRlbSgndXNlcnMnKSkgfHwgW107XG5cbiAgICBiYWNrZW5kLmNvbm5lY3Rpb25zLnN1YnNjcmliZSgoY29ubmVjdGlvbjogTW9ja0Nvbm5lY3Rpb24pID0+IHtcbiAgICAgICAgc2V0VGltZW91dCgoKSA9PiB7XG4gICAgICAgICAgICBpZihjb25uZWN0aW9uLnJlcXVlc3QudXJsLmVuZHNXaXRoKCcvYXBpL2F1dGhlbnRpY2F0ZScpICYmIGNvbm5lY3Rpb24ucmVxdWVzdC5tZXRob2QgPT0gUmVxdWVzdE1ldGhvZC5Qb3N0KXtcbiAgICAgICAgICAgICAgICBsZXQgcGFyYW1zID0gSlNPTi5wYXJzZShjb25uZWN0aW9uLnJlcXVlc3QuZ2V0Qm9keSgpKTtcblxuICAgICAgICAgICAgICAgIGxldCBmaWx0ZXJlZFVzZXJzID0gdXNlcnMuZmlsdGVyKHVzZXIgPT4ge1xuICAgICAgICAgICAgICAgICAgICByZXR1cm4gdXNlci51c2VybmFtZSA9PT0gcGFyYW1zLnVzZXJuYW1lICYmIHVzZXIucGFzc3dvcmQgPT09IHBhcmFtcy5wYXNzd29yZDtcbiAgICAgICAgICAgICAgICB9KTtcblxuICAgICAgICAgICAgICAgIGlmKGZpbHRlcmVkVXNlcnMubGVuZ3RoKXtcbiAgICAgICAgICAgICAgICAgICAgbGV0IHVzZXIgPSBmaWx0ZXJlZFVzZXJzWzBdO1xuICAgICAgICAgICAgICAgICAgICBjb25uZWN0aW9uLm1vY2tSZXNwb25kKG5ldyBSZXNwb25zZShuZXcgUmVzcG9uc2VPcHRpb25zKHtcbiAgICAgICAgICAgICAgICAgICAgICAgIHN0YXR1czogMjAwLFxuICAgICAgICAgICAgICAgICAgICAgICAgYm9keToge1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgIGlkOiB1c2VyLmlkLFxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIHVzZXJuYW1lOiB1c2VyLnVzZXJuYW1lLFxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIGZpcnN0TmFtZTogdXNlci5maXJzdE5hbWUsXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgbGFzdE5hbWU6IHVzZXIubGFzdE5hbWUsXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgdG9rZW46IFwiZmFrZS1qd3QtdG9rZW5cIlxuICAgICAgICAgICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgICAgICB9KSkpO1xuICAgICAgICAgICAgICAgIH1lbHNle1xuICAgICAgICAgICAgICAgICAgICBjb25uZWN0aW9uLm1vY2tFcnJvcihuZXcgRXJyb3IoXCJVc2VybmFtZSBvciBwYXNzd29yZCBpbmNvcnJlY3QhXCIpKTtcbiAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgcmV0dXJuO1xuICAgICAgICAgICAgfVxuICAgICAgICAgICAgaWYoY29ubmVjdGlvbi5yZXF1ZXN0LnVybC5lbmRzV2l0aCgnL2FwaS91c2VycycpICYmIGNvbm5lY3Rpb24ucmVxdWVzdC5tZXRob2QgPT09IFJlcXVlc3RNZXRob2QuR2V0KXtcbiAgICAgICAgICAgICAgICBpZihjb25uZWN0aW9uLnJlcXVlc3QuaGVhZGVycy5nZXQoJ0F1dGhvcml6YXRpb24nKSA9PT0gJ0JlYXJlciBmYWtlLWp3dC10b2tlbicpe1xuICAgICAgICAgICAgICAgICAgICBjb25uZWN0aW9uLm1vY2tSZXNwb25kKG5ldyBSZXNwb25zZShuZXcgUmVzcG9uc2VPcHRpb25zKHtcbiAgICAgICAgICAgICAgICAgICAgICAgIHN0YXR1czogMjAwLFxuICAgICAgICAgICAgICAgICAgICAgICAgYm9keTogdXNlcnNcbiAgICAgICAgICAgICAgICAgICAgfSkpKTtcbiAgICAgICAgICAgICAgICB9IGVsc2XCoHtcbiAgICAgICAgICAgICAgICAgICAgY29ubmVjdGlvbi5tb2NrUmVzcG9uZChuZXcgUmVzcG9uc2UobmV3IFJlc3BvbnNlT3B0aW9ucyh7XG4gICAgICAgICAgICAgICAgICAgICAgICBzdGF0dXM6IDQwMVxuICAgICAgICAgICAgICAgICAgICB9KSkpO1xuICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICByZXR1cm47XG4gICAgICAgICAgICB9XG4gICAgICAgICAgICBpZihjb25uZWN0aW9uLnJlcXVlc3QudXJsLmVuZHNXaXRoKCcvYXBpL3VzZXJzJykgJiYgY29ubmVjdGlvbi5yZXF1ZXN0Lm1ldGhvZCA9PT0gUmVxdWVzdE1ldGhvZC5Qb3N0KXtcbiAgICAgICAgICAgICAgICBsZXQgbmV3VXNlciA9IEpTT04ucGFyc2UoY29ubmVjdGlvbi5yZXF1ZXN0LmdldEJvZHkoKSk7XG5cbiAgICAgICAgICAgICAgICBsZXQgZHVwbGljYXRlVXNlciA9IHVzZXJzLmZpbHRlcih1c2VyID0+IHtcbiAgICAgICAgICAgICAgICAgICAgcmV0dXJuIHVzZXIudXNlcm5hbWUgPT09IG5ld1VzZXIudXNlcm5hbWVcbiAgICAgICAgICAgICAgICB9KS5sZW5ndGg7XG4gICAgICAgICAgICAgICAgaWYoZHVwbGljYXRlVXNlcil7XG4gICAgICAgICAgICAgICAgICAgIHJldHVybiBjb25uZWN0aW9uLm1vY2tFcnJvcihuZXcgRXJyb3IoXCJVc2VybmFtZTogXCIgKyBuZXdVc2VyLnVzZXJuYW1lICsgXCIgaXMgYWxyZWFkeSB0YWtlbiFcIikpO1xuICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICBuZXdVc2VyLmlkID0gdXNlcnMubGVuZ3RoICsgMTtcbiAgICAgICAgICAgICAgICB1c2Vycy5wdXNoKG5ld1VzZXIpO1xuICAgICAgICAgICAgICAgIGxvY2FsU3RvcmFnZS5zZXRJdGVtKCd1c2VycycsIEpTT04uc3RyaW5naWZ5KHVzZXJzKSk7XG5cbiAgICAgICAgICAgICAgICBjb25uZWN0aW9uLm1vY2tSZXNwb25kKG5ldyBSZXNwb25zZShuZXcgUmVzcG9uc2VPcHRpb25zKHtcbiAgICAgICAgICAgICAgICAgICAgc3RhdHVzOiAyMDBcbiAgICAgICAgICAgICAgICB9KSkpO1xuICAgICAgICAgICAgICAgIHJldHVybiB0cnVlO1xuICAgICAgICAgICAgfVxuICAgICAgICAgICAgbGV0IHJlYWxIdHRwID0gbmV3IEh0dHAocmVhbEJhY2tFbmQsIG9wdGlvbnMpO1xuICAgICAgICAgICAgbGV0IHJlcXVlc3RPcHRpb25zID0gbmV3IFJlcXVlc3RPcHRpb25zKHtcbiAgICAgICAgICAgICAgICBtZXRob2Q6IGNvbm5lY3Rpb24ucmVxdWVzdC5tZXRob2QsXG4gICAgICAgICAgICAgICAgaGVhZGVyczogY29ubmVjdGlvbi5yZXF1ZXN0LmhlYWRlcnMsXG4gICAgICAgICAgICAgICAgYm9keTogY29ubmVjdGlvbi5yZXF1ZXN0LmdldEJvZHkoKSxcbiAgICAgICAgICAgICAgICB1cmw6IGNvbm5lY3Rpb24ucmVxdWVzdC51cmwsXG4gICAgICAgICAgICAgICAgd2l0aENyZWRlbnRpYWxzOiBjb25uZWN0aW9uLnJlcXVlc3Qud2l0aENyZWRlbnRpYWxzLFxuICAgICAgICAgICAgICAgIHJlc3BvbnNlVHlwZTogY29ubmVjdGlvbi5yZXF1ZXN0LnJlc3BvbnNlVHlwZVxuICAgICAgICAgICAgfSk7XG4gICAgICAgICAgICByZWFsSHR0cC5yZXF1ZXN0KGNvbm5lY3Rpb24ucmVxdWVzdC51cmwsIHJlcXVlc3RPcHRpb25zKVxuICAgICAgICAgICAgICAgIC5zdWJzY3JpYmUoKHJlc3BvbnNlOiBSZXNwb25zZSkgPT4ge1xuICAgICAgICAgICAgICAgICAgICBjb25uZWN0aW9uLm1vY2tSZXNwb25kKHJlc3BvbnNlKTtcbiAgICAgICAgICAgICAgICB9LFxuICAgICAgICAgICAgICAgIChlcnJvcjogYW55KSA9PntcbiAgICAgICAgICAgICAgICAgICAgY29ubmVjdGlvbi5tb2NrRXJyb3IoZXJyb3IpO1xuICAgICAgICAgICAgICAgIH0pXG4gICAgICAgIH0sIDUwMCk7XG4gICAgfSk7XG4gICAgcmV0dXJuIG5ldyBIdHRwKGJhY2tlbmQsIG9wdGlvbnMpO1xufTtcbmV4cG9ydCBsZXQgZmFrZUJhY2tlbmRQcm92aWRlciA9IHtcbiAgICBwcm92aWRlOiBIdHRwLFxuICAgIHVzZUZhY3Rvcnk6IGZha2VCYWNrZW5kRmFjdG9yeSxcbiAgICBkZXBzOiBbTW9ja0JhY2tlbmQsIEJhc2VSZXF1ZXN0T3B0aW9ucywgWEhSQmFja2VuZF1cbn07XG4iXX0=
